REPORTE DE AUDITOR칈A FORENSE "ZERO TOLERANCE"
=================================================
FECHA: 2024-05-22
AUDITOR: JULES (Rol: Arquitecto Senior & Cliente Exigente)
ESTADO: 游댮 CR칈TICO / 游리 ALERTA / 游댯 MEJORA

---

## 游댮 [BLOQUEANTE/CR칈TICO] - Seguridad, L칩gica y Estabilidad

1.  **Tecnolog칤a Incorrecta (Major Mismatch)**
    *   **Archivo:** `backend/requirements.txt` y `backend/wsgi.py`
    *   **Hallazgo:** El requerimiento indica "Revisa backend (FastAPI)", pero el c칩digo fuente es inequ칤vocamente **FLASK**.
    *   **Evidencia:** `requirements.txt` lista `Flask`, `Flask-SQLAlchemy`. `config.py` usa `SQLALCHEMY_DATABASE_URI`.
    *   **Riesgo:** Si intentas correr esto con un servidor ASGI (uvicorn/fastapi), fallar치 catastr칩ficamente.

2.  **Credenciales Hardcodeadas en Infraestructura**
    *   **Archivo:** `infra/docker-compose.yml` (L칤neas 7, 21)
    *   **Hallazgo:** `POSTGRES_PASSWORD: mkmonitor`.
    *   **Riesgo:** Si este archivo se usa para desplegar en staging/prod sin sobrescribir variables, la base de datos es vulnerable. No hay variable de entorno `POSTGRES_PASSWORD_FILE` para uso de Docker Secrets.

3.  **Inyecci칩n de Path Fr치gil en CLI**
    *   **Archivo:** `gandalf.py` (L칤neas 12-14)
    *   **Hallazgo:** `sys.path.append(os.path.join(BASE_DIR, 'backend'))`.
    *   **Riesgo:** Asume r칤gidamente la estructura de directorios. Si el script se mueve o ejecuta desde otro contexto (ej: como paquete instalado), romper치 todos los imports del backend.

4.  **L칩gica de "Dangerous Action" Insegura (UX/Security)**
    *   **Archivo:** `frontend/src/pages/DeviceDetailPage.jsx` (L칤nea 126)
    *   **Hallazgo:** `if (!window.confirm("..."))`.
    *   **Riesgo:** El uso de di치logos nativos del navegador (`alert`, `confirm`) es bloqueante para el hilo principal de JS y ofrece una UX terrible/insegura (f치cil de clickear por error). Debe usarse un Modal del Design System.

5.  **Configuraci칩n de CORS/API Incompleta**
    *   **Archivo:** `frontend/src/api/client.js` (L칤nea 10)
    *   **Hallazgo:** `baseURL: import.meta.env.VITE_API_URL || 'http://localhost:5000/api'`.
    *   **Riesgo:** Si la variable de entorno falta en el build de producci칩n, el frontend intentar치 atacar a `localhost` del cliente, rompiendo la app. Deber칤a fallar el build si no est치 definida o usar una relativa `/api`.

---

## 游리 [UX & CLIENTE] - "Callejones sin Salida" e Inconsistencias

1.  **"Spaghetti Styling" (Deuda Visual Masiva)**
    *   **Archivo:** `frontend/src/pages/DeviceDetailPage.jsx`
    *   **Hallazgo:** Uso excesivo de estilos en l칤nea (`style={{...}}`) en casi todos los `div`. (Ej: l칤neas 155, 158, 166, 178...).
    *   **Impacto:** Imposible de mantener, ignora el archivo `theme.css`, rompe el modo oscuro/claro si los colores est치n hardcodeados (ej: `color: 'var(--color-text-secondary)'` es un intento, pero mezcla l칩gica con presentaci칩n).

2.  **Flujos Faltantes (Dead Ends)**
    *   **Archivo:** `frontend/src/App.jsx`
    *   **Hallazgo:** No existen rutas para `/profile`, `/settings`, ni gesti칩n de usuarios, a pesar de que el modelo `User` tiene campos como `full_name`.
    *   **Impacto:** El usuario puede loguearse pero no puede cambiar su contrase침a ni ver sus datos.

3.  **Feedback de Usuario Inconsistente**
    *   **Archivo:** `frontend/src/pages/DeviceDetailPage.jsx` (L칤nea 137)
    *   **Hallazgo:** `alert("Hubo un error al eliminar el dispositivo.")` en el catch.
    *   **Impacto:** El sistema usa `SessionExpiredModal` (custom) para auth, pero `alert()` nativo para errores de negocio. Incoherencia visual total.

4.  **Mock Data "Sucio" en Producci칩n**
    *   **Archivo:** `frontend/src/pages/DeviceDetailPage.jsx` (L칤neas 43-73)
    *   **Hallazgo:** La funci칩n `getMockForensicData` est치 definida *dentro* del componente y ocupa 30 l칤neas de c칩digo que se env칤an al cliente final.
    *   **Impacto:** Aumenta el bundle size y ensucia el c칩digo. Debe moverse a un servicio `mockService.js` y cargarse condicionalmente.

---

## 游댯 [LIMPIEZA & REFACTOR] - Calidad de C칩digo

1.  **Disonancia en Docker Mounts**
    *   **Archivo:** `infra/docker-compose.yml` vs `backend/Dockerfile`
    *   **Hallazgo:** Dockerfile copia a `./app` (workdir `/app`), pero Compose monta `../backend/app:/app/app`.
    *   **Problema:** Crea una estructura anidada confusa `/app/app` dentro del contenedor. Si un import absoluto en Python espera `backend.app`, esto puede causar "ModuleNotFoundError" dependiendo de c칩mo se lance Gunicorn.

2.  **Scripts Monol칤ticos**
    *   **Archivo:** `gandalf.py`
    *   **Hallazgo:** Mezcla l칩gica de presentaci칩n (ASCII Art, colores), l칩gica de negocio (mining) y configuraci칩n en un solo archivo de 300 l칤neas.
    *   **Sugerencia:** Separar en `scripts/cli/ui.py`, `scripts/cli/core.py`.

3.  **Imports de React Obsoletos/Redundantes**
    *   **Archivo:** `frontend/src/pages/DeviceDetailPage.jsx`
    *   **Hallazgo:** `import React, { ... } from 'react'`.
    *   **Mejora:** En React 17+ (Vite), importar `React` ya no es estrictamente necesario para JSX, solo los hooks. Limpieza menor.

---

**CONCLUSI칍N DEL ARQUITECTO:**
El proyecto tiene una base s칩lida en el backend (Flask bien estructurado con Blueprints y Config class), pero el frontend sufre de "prisa por prototipar" (estilos en l칤nea, mocks hardcodeados, alerts nativos). La discrepancia Flask/FastAPI en la documentaci칩n/requerimiento es el error m치s grave de comunicaci칩n.

**ACCI칍N RECOMENDADA INMEDIATA:**
1.  Confirmar si se migra a FastAPI o se actualiza la documentaci칩n para decir "Flask".
2.  Refactorizar `DeviceDetailPage` para eliminar estilos en l칤nea y usar clases CSS.
3.  Reemplazar `window.confirm` y `alert` por componentes del sistema de dise침o.
